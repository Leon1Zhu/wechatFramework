<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微服务架构分析文档 | 架构图</title>
    <meta name="description" content="软体构作业">
    
    
    <link rel="preload" href="/wechatFramework/assets/css/6.styles.f1b5db38.css" as="style"><link rel="preload" href="/wechatFramework/assets/js/app.59c475ef.js" as="script"><link rel="preload" href="/wechatFramework/assets/js/4.462a1429.js" as="script"><link rel="prefetch" href="/wechatFramework/assets/js/0.afe400e8.js"><link rel="prefetch" href="/wechatFramework/assets/js/1.643387ae.js"><link rel="prefetch" href="/wechatFramework/assets/js/2.d969aef1.js"><link rel="prefetch" href="/wechatFramework/assets/js/3.380a473d.js"><link rel="prefetch" href="/wechatFramework/assets/js/5.0df69df7.js">
    <link rel="stylesheet" href="/wechatFramework/assets/css/6.styles.f1b5db38.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/wechatFramework/" class="home-link router-link-active"><!----><span class="site-name">
      微服务架构分析文档
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><a href="https://github.com/ZhuLiangT/wechatFramework" target="_blank" rel="noopener noreferrer" class="github-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><a href="https://github.com/ZhuLiangT/wechatFramework" target="_blank" rel="noopener noreferrer" class="github-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><a href="/wechatFramework/" class="sidebar-link">微服务简介</a></li><li><a href="/wechatFramework/whyUse/" class="sidebar-link">为什么要使用微服务</a></li><li><a href="/wechatFramework/frameConstitute/" class="active sidebar-link">框架构成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wechatFramework/frameConstitute/#架构图" class="sidebar-link">架构图</a></li><li class="sidebar-sub-header"><a href="/wechatFramework/frameConstitute/#api网关" class="sidebar-link">API网关</a></li><li class="sidebar-sub-header"><a href="/wechatFramework/frameConstitute/#微服务" class="sidebar-link">微服务</a></li><li class="sidebar-sub-header"><a href="/wechatFramework/frameConstitute/#服务发现" class="sidebar-link">服务发现</a></li><li class="sidebar-sub-header"><a href="/wechatFramework/frameConstitute/#云配置" class="sidebar-link">云配置</a></li><li class="sidebar-sub-header"><a href="/wechatFramework/frameConstitute/#日志采集" class="sidebar-link">日志采集</a></li><li class="sidebar-sub-header"><a href="/wechatFramework/frameConstitute/#uaa" class="sidebar-link">UAA</a></li></ul></li><li><a href="/wechatFramework/relativeMerits/" class="sidebar-link">微服务调用方式</a></li><li><a href="/wechatFramework/summary/" class="sidebar-link">总结</a></li></ul></div><div class="page"><div class="content"><h2 id="架构图"><a href="#架构图" aria-hidden="true" class="header-anchor">#</a> 架构图</h2><p><img src="http://otdc3q7z7.bkt.clouddn.com/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="微服务架构图"></p><h2 id="api网关"><a href="#api网关" aria-hidden="true" class="header-anchor">#</a> API网关</h2><ul><li><strong>定义:</strong><ul><li>API网关是一个服务器，是系统的唯一入口。从面向对象设计的角度看，它与外观模式类似。
API网关方式的核心要点是，所有的客户端和消费端都通过统一的网关接入微服务，在网关层处理所有的非业务功能。通常，网关也是提供REST/HTTP的访问API。服务端通过API-GW注册和管理服务。</li></ul></li><li><strong>作用:</strong><ul><li>API网关是一个服务器，是系统的唯一入口。API网关封装了系统的内部架构，为每一个客户提供一个定制的API。它还具有其他职责，如身份验证、监控、负载均衡、缓存等。API网关负责服务请求路由、组合及协议转换。客户端的所有请求都首先经过API网关，然后由它将请求路由到合适的微服务。</li><li>API网关也是解决访问认证、报文转换、访问统计等问题的。不仅增加了后台服务的响应量，还增加了后台服务的复杂性。</li></ul></li><li><strong>优点:</strong><ul><li>对外部和内部进行了隔离，保障了后台服务的安全性。</li><li>对外访问控制由网络层面转换成了运维层面，减少变更的流程和错误成本。</li><li>减少客户端与服务的耦合，服务可以独立运行。通过网关做映射。</li><li>通关网关层的聚合，减少外部访问的频次，提升访问效率。</li><li>节约后端服务开发成本，减少上线风险。</li><li>服务使用了多种协议，因为不同的协议有不同的应场景用，比如可能同时使用 HTTP, AMQP, gRPC使用API网关可以统一调度。</li><li>服务端在多个服务器上部署可以自动集群</li><li>对所有的服务接口做统一的安全拦截和权限校验</li></ul></li></ul><h2 id="微服务"><a href="#微服务" aria-hidden="true" class="header-anchor">#</a> 微服务</h2><ul><li><strong>定义</strong><ul><li>微服务将系统模块切分成多个细小服务，每个细小服务分开开发和部署，服务之间通过轻量级的通讯接口实现内部调用。</li></ul></li><li><strong>作用</strong><ul><li>将复杂的单体应用分解成一个个微小的服务。</li><li>可以使得不同的服务之间实现不同的功能。</li></ul></li><li><strong>优点</strong><ul><li>将复杂的应用分解之后使得大问题分解成多个小问题解决，减少耦合，互不影响。</li><li>方便以后的维护和重构，减少维护的成本和工作量。</li><li>不需要再对不同框架的使用而烦恼。每个服务之间相互独立，不会互相作用，这给一套系统，不同框架提供了可能。</li><li>微服务便于开发、部署和变更，升级某个服务不会影响整个系统。每个服务功能比较少，方便业务变更。</li></ul></li></ul><h2 id="服务发现"><a href="#服务发现" aria-hidden="true" class="header-anchor">#</a> 服务发现</h2><ul><li><p><strong>定义</strong></p><ul><li>在微服务架构中，微服务实例的网络位置发生变化是一种常态，所以必须提供一种机制，使得服务消费者在服务提供者的网络位置发生变化时，能够及时获得最新的位置信息，一般是提供一个网络位置稳定的服务注册中心，服务提供者的网络位置被注册到注册中心，并在网络位置发生变化的时候及时更新，而服务消费者定期向注册中心获取服务提供者的最新位置信息。</li></ul></li><li><p><strong>模式</strong></p><p><strong>1.客户端发现模式</strong><img src="http://otdc3q7z7.bkt.clouddn.com/96EABEEB-6018-45D5-B1CB-E401591081E2.png" alt="客户端发现模式图"></p><ul><li><strong>工作方式</strong><ul><li>当服务实例启动的时候，它的网络地址被注册到服务注册中心。当该实例终止的时候，该地址从服务注册中心移除。服务实例的注册通常使用心跳机制定期刷新。</li></ul></li><li><strong>客户端发现模式的优缺点</strong><ul><li>优点：
<ul><li>这个模式相对更直接一点，除了服务注册中心，没有要改变的地方；</li><li>因为客户端了解可用的服务实例，它能做出智能、针对特定应用的负载均衡决策，比如使用一致性哈希。</li></ul></li><li>缺点：
<ul><li>这种模式的一个重要的缺陷是它将客户端与服务注册中心耦合在一起。你必须为服务客户端使用的每种编程语言和框架都实现服务发现逻辑；
<strong>2.服务端发现模式</strong><img src="http://otdc3q7z7.bkt.clouddn.com/20170715135600567.png" alt="服务端发现模式"></li></ul></li></ul></li><li><strong>工作方式</strong><ul><li>当服务启动的时候,服务端通过负载均衡器向服务发送请求。负载均衡器查询服务注册中心并路由每个请求到可用的服务实例。</li></ul></li><li><strong>服务端发现模式的优缺点</strong><ul><li>优点：
<ul><li>服务发现的细节从客户端抽象出来，客户端只需要给负载均衡器发请求即可。这种方式避免为服务客户端使用的每种编程语言和框架都实现服务发现逻辑；</li><li>一些部署环境免费提供了这种功能，无需再自己开发。</li></ul></li><li>缺点：
<ul><li>除非部署环境提供负载均衡器，否则它又是另一个需要设置和管理的高度可用的系统组件。</li></ul></li></ul></li></ul></li></ul><h2 id="云配置"><a href="#云配置" aria-hidden="true" class="header-anchor">#</a> 云配置</h2><p><img src="http://otdc3q7z7.bkt.clouddn.com/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BA%91%E9%85%8D%E7%BD%AE.png" alt="云配置示意图"></p><ul><li><strong>定义</strong><ul><li>微服务架构允许将应用的配置文件放在远程服务器上，修改远程服务器的配置之后自动刷新所有服务的配置文件，无须重启服务。</li></ul></li><li><strong>作用</strong><ul><li>单体应用将配置文件打包在项目中发布，配置发生变更只需更改配置后重启即可。微服务采用分布式架构，一个系统可能由成百上千个应用组成，一旦某个配置发生变更，修改配置的成本极大，甚至导致系统长时间无法提供服务，而使用云配置则可以很大程度上优化和解决这些问题。</li></ul></li></ul><h2 id="日志采集"><a href="#日志采集" aria-hidden="true" class="header-anchor">#</a> 日志采集</h2><p><img src="http://otdc3q7z7.bkt.clouddn.com/%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E7%B3%BB%E7%BB%9F.png" alt="日志采集系统可视化"></p><ul><li><strong>定义</strong><ul><li>微服务架构的分布式和集群特性使得当系统出错时，错误的定位变的十分复杂，这就需要一款配套的日志采集系统进行日志收集、分析、预警。</li></ul></li><li><strong>作用</strong><ul><li>方便了对系统发生的错误进行排查和解决，无需再进行复杂的分析。</li><li>日志通过日志转化服务后入库存储，通过可视化系统，对系统的运行情况可以有一个全面的分析。</li></ul></li></ul><h2 id="uaa"><a href="#uaa" aria-hidden="true" class="header-anchor">#</a> UAA</h2><ul><li><strong>定义</strong><ul><li>UAA全称为user accounting and authorizing service，用户账户和授权服务，基于Oauth2.0标准，支持Oauth2.0的所有授权方式。微服务框架采用UAA做为系统的统一认证服务， UAA负责用户登录、系统接入和令牌发放。</li></ul></li><li><strong>作用</strong><ul><li>由于微服务是关于构建大多数独立自主的应用程序，使用UAA可以让用户拥有一致的用户体验，不会注意到请求由不同的程序提供，并且可以具有单独的安全配置。</li><li>在维护集中角色的同时，需要在每个微服务中配置详细的访问权限。微服务应该知道每个用户的权限，并且必须对传入的请求授权。</li><li>使用UAA进行权限管理。可以最大程度上为微服务系统提供安全保障</li></ul></li></ul></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/wechatFramework/whyUse/" class="prev">
          为什么要使用微服务
        </a></span><span class="next"><a href="/wechatFramework/relativeMerits/">
          微服务调用方式
        </a> →
      </span></p></div></div></div></div>
    <script src="/wechatFramework/assets/js/4.462a1429.js" defer></script><script src="/wechatFramework/assets/js/app.59c475ef.js" defer></script>
  </body>
</html>
